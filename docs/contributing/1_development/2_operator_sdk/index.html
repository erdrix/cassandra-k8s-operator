<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Operator SDK</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Casskop · Open-Source, Apache Cassandra operator for Kubernetes"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="## Prerequisites"><meta data-react-helmet="true" property="og:description" content="## Prerequisites"><meta data-react-helmet="true" property="og:url" content="https://erdrix.github.io/casskop/docs/contributing/1_development/2_operator_sdk">

<link data-react-helmet="true" rel="shortcut icon" href="/casskop/img/casskop.ico">


<link rel="stylesheet" href="/casskop/styles.4bb9a4a4.css">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}function e(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}var n=window.matchMedia("(prefers-color-scheme: dark)");n.addListener((function(n){null===e()&&t(n.matches?"dark":"")}));var a=e();null!==a?t(a):n.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/casskop/"><img class="navbar__logo" src="/casskop/img/casskop_alone.png" alt="Casskop Logo"><strong>Casskop</strong></a><a class="navbar__item navbar__link" href="/casskop/docs/overview">Docs</a><a class="navbar__item navbar__link" href="/casskop/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/Orange-OpenSource/casskop">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/casskop/"><img class="navbar__logo" src="/casskop/img/casskop_alone.png" alt="Casskop Logo"><strong>Casskop</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/overview">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/Orange-OpenSource/casskop">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Overview</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Casskop</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/1_getting_started/1_overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/1_getting_started/2_Pre-requisites">Pre-requisites</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/1_getting_started/3_quickstart">Quickstart</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Deployment Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/1_cassandra_cluster_config">Cassandra cluster configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/2_cassandra_config">Cassandra configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/3_cassandra_storage">Cassandra storage</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/4_kubernetest_object">Kubernetes objects</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/5_cpu_memory_resources">CPU and memory resources</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/6_cluster_topology">Cluster topology - Cassandra rack aware deployments</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/7_implementation_architecture">Implementation architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/8_advanced_configuration">Advanced configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/9_cassandra_node_management">Cassandra nodes management</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/10_cassandracluster_status">Cassandra cluster status</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/2_deployment_configuration/11_cassandracluster_crd_definition">Cassandra cluster CRD definition</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Operations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/3_operations/1_overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/3_operations/2_cluster_operations">Cluster operations</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/3_operations/3_cassandra_pods_operations">Cluster operations</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/casskop/4_troubleshooting">Troubleshooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Multi-Casskop</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/multi-casskop/1_overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/multi-casskop/2_pre-requisite">Pre-requisite</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/multi-casskop/3_quickstart">Quickstart</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Contributing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/1_development/1_circle_ci_build_pipeline">CircleCI build pipeline</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/casskop/docs/contributing/1_development/2_operator_sdk">Operator SDK</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release the project</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/2_release_project/1_tasks">Tasks</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/2_release_project/2_with_helm">With Helm</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/2_release_project/3_with_olm">With OLM</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/3_reporting_bugs">Reporting bugs</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How this repository was initially build</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/4_initial_build/1_boilerplate_casskop">Boilerplate CassKop</a></li><li class="menu__list-item"><a class="menu__link" href="/casskop/docs/contributing/4_initial_build/2_infos_developer">Useful Infos for developers</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Operator SDK</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="prerequisites"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#prerequisites" title="Direct link to heading">#</a>Prerequisites</h2><p>Casskop has been validated with :</p><ul><li><a href="dep_tool">dep</a> version v0.5.1+.</li><li><a href="go_tool">go</a> version v1.12.4+.</li><li><a href="docker_tool">docker</a> version 18.09+.</li><li><a href="kubectl_tool">kubectl</a> version v1.13.3+.</li><li><a href="https://helm.sh/">Helm</a> version v2.12.2.</li><li><a href="https://github.com/operator-framework/operator-sdk">Operator sdk</a> version v0.9.0.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="install-the-operator-sdk-cli"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#install-the-operator-sdk-cli" title="Direct link to heading">#</a>Install the Operator SDK CLI</h2><p>First, checkout and install the operator-sdk CLI:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir -p $GOPATH/src/github.com/operator-framework/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd $GOPATH/src/github.com/operator-framework/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone git@github.com:operator-framework/operator-sdk.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git checkout v0.9.0</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make install</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="initial-setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#initial-setup" title="Direct link to heading">#</a>Initial setup</h2><p>Checkout the project.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone https://github.com/Orange-OpenSource/casskop.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd casskop</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="local-kubernetes-setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#local-kubernetes-setup" title="Direct link to heading">#</a>Local kubernetes setup</h2><p>We use <a href="https://kind.sigs.k8s.io">kind</a> in order to run a local kubernetes cluster with the version we chose. We think it deserves some words as it&#x27;s pretty useful and simple to use to test one version or another</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="install"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#install" title="Direct link to heading">#</a>Install</h3><p>The following requires kubens to be present. On MacOs it can be installed using brew :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">brew install kubectx</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>The installation of kind is then done with (outside of the cassandra operator folder if you want it to run fast) :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ GO111MODULE=&quot;on&quot; go get sigs.k8s.io/kind@v0.5.1</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="setup"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#setup" title="Direct link to heading">#</a>Setup</h3><p>The following actions should be run only to create a new kubernetes cluster.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/create-kind-cluster.sh</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>or if you want to enable network policies</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/create-kind-cluster-network-policies.sh</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>It creates namespace cassandra-e2e by default. If a different namespace is needed it can be specified on the setup-requirements call</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ samples/kind/setup-requirements.sh other-namespace</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>To interact with the cluster you then need to use the generated kubeconfig file :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export KUBECONFIG=$(kind get kubeconfig-path --name=kind)</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Before using that newly created cluster, it&#x27;s better to wait for all pods to be running by continously checking their status :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pod --all-namespaces -w</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="pauseunpause-the-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pauseunpause-the-cluster" title="Direct link to heading">#</a>Pause/Unpause the cluster</h3><p>In order to kinda freeze the cluster because you need to do something else on your laptop, you can use those two aliases. Just put them in your ~/.bashrc or ~/.zshrc :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">alias kpause=&#x27;kind get nodes|xargs docker pause&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">alias kunpause=&#x27;kind get nodes|xargs docker unpause&#x27;</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="delete-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#delete-cluster" title="Direct link to heading">#</a>Delete cluster</h3><p>The simple command <code>kind delete cluster</code> takes care of it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="build-casskop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#build-casskop" title="Direct link to heading">#</a>Build CassKop</h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="using-your-local-environment"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-your-local-environment" title="Direct link to heading">#</a>Using your local environment</h3><p>If you prefer working directly with your local go environment you can simply uses :</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make get-deps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make build</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><blockquote><p>You can check on the Gitlab Pipeline to see how the Project is build and test for each push</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="or-using-the-provided-cross-platform-build-environment"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#or-using-the-provided-cross-platform-build-environment" title="Direct link to heading">#</a>Or Using the provided cross platform build environment</h3><p>Build the docker image which will be used to build CassKop docker image</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make build-ci-image</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><blockquote><p>If you want to change the operator-sdk version change the <strong>OPERATOR_SDK_VERSION</strong> in the Makefile.</p></blockquote><p>Then build CassKop (code &amp; image)</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-get-deps</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">make docker-build</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="run-casskop"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-casskop" title="Direct link to heading">#</a>Run CassKop</h2><p>We can quickly run CassKop in development mode (on your local host), then it will use your kubectl configuration file to connect to your kubernetes cluster.</p><p>There are several ways to execute your operator :</p><ul><li>Using your IDE directly</li><li>Executing directly the Go binary</li><li>deploying using the Helm charts</li></ul><p>If you want to configure your development IDE, you need to give it environment variables so that it will uses to connect to kubernetes.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">KUBECONFIG=&lt;path/to/your/kubeconfig&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">WATCH_NAMESPACE=&lt;namespace_to_watch&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">POD_NAME=&lt;name for operator pod&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">LOG_LEVEL=Debug</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">OPERATOR_NAME=ide</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="run-the-operator-locally-with-the-go-binary"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-the-operator-locally-with-the-go-binary" title="Direct link to heading">#</a>Run the Operator Locally with the Go Binary</h3><p>This method can be used to run the operator locally outside of the cluster. This method may be preferred during development as it facilitates faster deployment and testing.</p><p>Set the name of the operator in an environment variable</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export OPERATOR_NAME=cassandra-operator</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Deploy the CRD</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f deploy/crds/db_v1alpha1_cassandracluster_crd.yaml</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make run</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>This will run the operator in the <code>default</code> namespace using the default Kubernetes config file at <code>$HOME/.kube/config</code>.</p><p><strong>Note:</strong> JMX operations cannot be executed on Cassandra nodes when running the operator locally. This is because the operator makes JMX calls over HTTP using jolokia and when running locally the operator is on a different network than the Cassandra cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="deploy-using-the-helm-charts"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#deploy-using-the-helm-charts" title="Direct link to heading">#</a>Deploy using the Helm Charts</h3><p>This section provides an instructions for running the operator Helm charts with an image that is built from the local branch.</p><p>Build the image from the current branch.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ export DOCKER_REPO_BASE=&lt;your-docker-repo&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make docker-build</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>Push the image to docker hub (or to whichever repo you want to use)</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make push</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>Note:</strong> In this example we are pushing to docker hub.</p><p><strong>Note:</strong> The image tag is a combination of the version as defined in <code>verion/version.go</code> and the branch name.</p><p>Install the Helm chart.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm install ./helm/cassandra-operator \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set-string image.repository=orangeopensource/casskop,image.tag=0.4.0-local-dev-helm \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --name local-dev-helm</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>Note:</strong> The <code>image.repository</code> and <code>image.tag</code> template variables have to match the names from the image that we pushed in the previous step.</p><p><strong>Note:</strong> We set the chart name to the branch, but it can be anything.</p><p>Lastly, verify that the operator is running.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                                                READY   STATUS    RESTARTS   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">local-dev-helm-cassandra-operator-8946b89dc-4cfs9   1/1     Running   0          7m45s</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="run-unit-tests"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-unit-tests" title="Direct link to heading">#</a>Run unit-tests</h2><p>You can run Unit-test for CassKop</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-sh codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make unit-test</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="run-e2e-end-to-end-tests"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-e2e-end-to-end-tests" title="Direct link to heading">#</a>Run e2e end to end tests</h2><p>CassKop also have several end-to-end tests that can be run using makefile.</p><p>You need to create the namespace <code>cassandra-e2e</code> before running the tests.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create namespace cassandra-e2e</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>to launch different tests in parallel in different temporary namespaces</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p>or sequentially in the namespace <code>cassandra-e2e</code></p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>Note</strong>: <code>make e2e</code> executes all tests in different, temporary namespaces in parallel. Your k8s cluster will need a lot of resources to handle the many Cassandra nodes that launch in parallel. </p><p><strong>Note</strong>: <code>make e2e-test-fix</code> executes all tests serially in the <code>cassandra-e2e</code> namespace and as such does not require as many k8s resources as <code>make e2e</code> does, but overall execution will be slower.</p><p>You can choose to run only 1 test using the args ex:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make e2e-test-fix-arg ClusterScaleDown</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><p><strong>Tip</strong>: When debugging test failures, you can run <code>kubectl get events --all-namespaces</code> which produce output like:</p><p><code>cassandracluster-group-clusterscaledown-1561640024   0s    Warning   FailedScheduling   Pod   0/4 nodes are available: 1 node(s) had taints that the pod didn&#x27;t tolerate, 3 Insufficient cpu.</code></p><p><strong>Tip</strong>: When tests fail, there may be resources that need to be cleaned up. Run <code>tools/e2e_test_cleanup.sh</code> to delete resources left over from tests.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="debug-casskop-in-remote-in-a-kubernetes-cluster"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#debug-casskop-in-remote-in-a-kubernetes-cluster" title="Direct link to heading">#</a>Debug CassKop in remote in a Kubernetes cluster</h2><p>CassKop makes some specific calls to the Jolokia API of the CassandraNodes it deploys inside the kubernetes
cluster. Because of this, it is not possible to fully debug CassKop when launch outside the kubernetes cluster (in your local IDE).</p><p>It is possible to use external solutions such as KubeSquash or Telepresence.</p><p>Telepresence launch a bi-directional tunnel between your dev environment and an existing operator pod in the cluster which it will <strong>swap</strong></p><p>To launch the telepresence utility you can launch</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">make telepresence</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><blockquote><p>You need to install it before see : <a href="https://www.telepresence.io/">https://www.telepresence.io/</a></p></blockquote><p>If your cluster don&#x27;t have Internet access, you can change the telepresence image to use to one your cluster have access
exemple:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2av3"><pre class="prism-code language-console codeBlock_2GNs" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TELEPRESENCE_REGISTRY=you-private-registry/datawire  make debug-telepresence-with-alias</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1Zmi">Copy</button></div></pre><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="configure-the-ide"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#configure-the-ide" title="Direct link to heading">#</a>Configure the IDE</h3><p>Now we just need to configure the IDE :</p><p><img src="https://raw.githubusercontent.com/Orange-OpenSource/casskop/master/documentation/images/ide_debug_configutation.png" alt="ide_debug_configutation"></p><p>and let&#x27;s the magic happened</p><p><img src="https://raw.githubusercontent.com/Orange-OpenSource/casskop/master/documentation/images/ide_debug_action.png" alt="ide_debug_action"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://erdrix.github.io/casskop/edit/master/website/docs/contributing/1_development/2_operator_sdk.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/casskop/docs/contributing/1_development/1_circle_ci_build_pipeline"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« CircleCI build pipeline</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/casskop/docs/contributing/2_release_project/1_tasks"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Tasks »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#prerequisites" class="contents__link">Prerequisites</a></li><li><a href="#install-the-operator-sdk-cli" class="contents__link">Install the Operator SDK CLI</a></li><li><a href="#initial-setup" class="contents__link">Initial setup</a></li><li><a href="#local-kubernetes-setup" class="contents__link">Local kubernetes setup</a><ul><li><a href="#install" class="contents__link">Install</a></li><li><a href="#setup" class="contents__link">Setup</a></li><li><a href="#pauseunpause-the-cluster" class="contents__link">Pause/Unpause the cluster</a></li><li><a href="#delete-cluster" class="contents__link">Delete cluster</a></li></ul></li><li><a href="#build-casskop" class="contents__link">Build CassKop</a><ul><li><a href="#using-your-local-environment" class="contents__link">Using your local environment</a></li><li><a href="#or-using-the-provided-cross-platform-build-environment" class="contents__link">Or Using the provided cross platform build environment</a></li></ul></li><li><a href="#run-casskop" class="contents__link">Run CassKop</a><ul><li><a href="#run-the-operator-locally-with-the-go-binary" class="contents__link">Run the Operator Locally with the Go Binary</a></li><li><a href="#deploy-using-the-helm-charts" class="contents__link">Deploy using the Helm Charts</a></li></ul></li><li><a href="#run-unit-tests" class="contents__link">Run unit-tests</a></li><li><a href="#run-e2e-end-to-end-tests" class="contents__link">Run e2e end to end tests</a></li><li><a href="#debug-casskop-in-remote-in-a-kubernetes-cluster" class="contents__link">Debug CassKop in remote in a Kubernetes cluster</a><ul><li><a href="#configure-the-ide" class="contents__link">Configure the IDE</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Getting Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/casskop/docs/overview">Documentation</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/Orange-OpenSource/casskop">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://casskop.slack.com">Slack</a></li><li class="footer__item"><a class="footer__link-item" href="/casskop/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contact</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="mailto:prj.casskop.support@list.orangeportails.net">Email</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/Orange-OpenSource/casskop/issues">Feature request</a></li></ul></div></div><div class="text--center">Copyright © 2020 Orange, Inc. Built with Docusaurus.</div></div></footer>
</div>

<script src="/casskop/styles.01bd69bb.js"></script>

<script src="/casskop/runtime~main.6de1850d.js"></script>

<script src="/casskop/main.1e1e5e5f.js"></script>

<script src="/casskop/1.24070d49.js"></script>

<script src="/casskop/2.3c1bdb43.js"></script>

<script src="/casskop/1be78505.72d8905a.js"></script>

<script src="/casskop/3cde0363.a5898433.js"></script>

<script src="/casskop/17896441.0273ebd2.js"></script>

<script src="/casskop/454de624.59ef4387.js"></script>


</body>
</html>